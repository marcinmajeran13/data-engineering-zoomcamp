CREATE TEMP TABLE delete_normalised_exercise_f6d09be628162c1875a5d2952f7110c9 AS SELECT d."_dlt_id" FROM "normalised_rides"."normalised_exercise" as d WHERE EXISTS (SELECT 1 FROM "normalised_rides_staging"."normalised_exercise" as s WHERE d."record_hash" = s."record_hash");
DELETE FROM "normalised_rides"."normalised_exercise__passengers"             WHERE "_dlt_root_id" IN (                 SELECT * FROM delete_normalised_exercise_f6d09be628162c1875a5d2952f7110c9             );         
DELETE FROM "normalised_rides"."normalised_exercise__stops"             WHERE "_dlt_root_id" IN (                 SELECT * FROM delete_normalised_exercise_f6d09be628162c1875a5d2952f7110c9             );         
DELETE FROM "normalised_rides"."normalised_exercise"             WHERE "_dlt_id" IN (                 SELECT * FROM delete_normalised_exercise_f6d09be628162c1875a5d2952f7110c9             );         
CREATE TEMP TABLE insert_normalised_exercise_38f330a2fa01a8ecb1de5b1861510c1a AS              SELECT "_dlt_id"                 FROM (                     SELECT ROW_NUMBER() OVER (partition BY "record_hash" ORDER BY (SELECT NULL)) AS _dlt_dedup_rn, "_dlt_id"                     FROM "normalised_rides_staging"."normalised_exercise"                 ) AS _dlt_dedup_numbered WHERE _dlt_dedup_rn = 1 AND (1 = 1)         ;
INSERT INTO "normalised_rides"."normalised_exercise"("vendor_name", "record_hash", "time__pickup", "time__dropoff", "trip_distance", "coordinates__start__lon", "coordinates__start__lat", "coordinates__end__lon", "coordinates__end__lat", "payment__type", "payment__amt", "payment__surcharge", "payment__tip", "payment__tolls", "payment__status", "passenger_count", "_dlt_load_id", "_dlt_id") SELECT "vendor_name", "record_hash", "time__pickup", "time__dropoff", "trip_distance", "coordinates__start__lon", "coordinates__start__lat", "coordinates__end__lon", "coordinates__end__lat", "payment__type", "payment__amt", "payment__surcharge", "payment__tip", "payment__tolls", "payment__status", "passenger_count", "_dlt_load_id", "_dlt_id" FROM "normalised_rides_staging"."normalised_exercise" WHERE "_dlt_id" IN (SELECT * FROM insert_normalised_exercise_38f330a2fa01a8ecb1de5b1861510c1a);
INSERT INTO "normalised_rides"."normalised_exercise__passengers"("name", "rating", "_dlt_root_id", "_dlt_parent_id", "_dlt_list_idx", "_dlt_id") SELECT "name", "rating", "_dlt_root_id", "_dlt_parent_id", "_dlt_list_idx", "_dlt_id" FROM "normalised_rides_staging"."normalised_exercise__passengers" WHERE "_dlt_root_id" IN (SELECT * FROM insert_normalised_exercise_38f330a2fa01a8ecb1de5b1861510c1a);
INSERT INTO "normalised_rides"."normalised_exercise__stops"("lon", "lat", "_dlt_root_id", "_dlt_parent_id", "_dlt_list_idx", "_dlt_id") SELECT "lon", "lat", "_dlt_root_id", "_dlt_parent_id", "_dlt_list_idx", "_dlt_id" FROM "normalised_rides_staging"."normalised_exercise__stops" WHERE "_dlt_root_id" IN (SELECT * FROM insert_normalised_exercise_38f330a2fa01a8ecb1de5b1861510c1a);